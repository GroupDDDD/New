<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>게시자용 채팅리스트</title>
    <!-- axios cdn -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <!-- jquery cdn -->
    <script
      src="https://code.jquery.com/jquery-3.6.0.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymous"
    ></script>
    <!-- socket.io cdn -->
    <script
      src="https://cdn.socket.io/4.5.3/socket.io.min.js"
      integrity="sha384-WPFUvHkB1aHA5TDSZi6xtDgkF0wXJcIIxXhC6h8OT8EH3fC5PWro5pWJ1THjcfEi"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <h2>채팅목록</h2>
    <table border="1" cellspacing="0">
      <thead>
        <tr>
          <th>스터디원프로필</th>
          <th>스터디원</th>
          <th>게시글제목</th>
          <th>임시채팅방입장</th>
        </tr>
      </thead>
      <tbody>
        <!-- data: db에서 가지고 오는 데이터 => 새로고침해도 데이터 남아있음 -->
        <% for (let i = 0; i < data.length; i++) { %>
        <!-- <tr id="tr_<%= data[i].id %>"> -->
        <tr id="userid">
          <td><%= data[i].prof_img_url %></td>
          <td><%= data[i].user_name %></td>
          <td><%= data[i].title %></td>
          <td>
            <button
              type="button"
              onclick="chatEntry('<%= data[i].user_index %>', '<%= pubId %>', '<%= data[i].room_id %>');"
            >
              Go
            </button>
          </td>
        </tr>
        <% } %>
        <!-- 추가되어야할 tr 위치 -> 종료태그의 앞(beforeend) -->
      </tbody>
    </table>

    <script>
      // 채팅창 입장
      function chatEntry(user_index, id, room_id) {
        console.log(user_index);
        console.log(id);
        console.log(room_id);

        // 채팅창 조회
        axios({
          method: "GET",
          url: "/chatcont/getChatcont",
          data: {
            thisId: user_index, // obj.user_index: 클릭한 채팅방의 chat_participants테이블의 user_index
            pubId: id, // 로그인한 사람의 user_index
            roomId: room_id,
          },
        }).then((res) => {
          console.log(res.data);
          return res.data;
        });
      }
    </script>
  </body>
</html>
