<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>회원정보</title>

    <!-- axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <!-- kakao geolocation -->
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=966cd89e4a2aec000f0c186e68244c89"></script>

    <!-- kakao 라이브러리 -->
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=APIKEY&libraries=LIBRARY"></script>
    <!-- services 라이브러리 불러오기 -->
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=APIKEY&libraries=services"></script>
    <!-- services와 clusterer, drawing 라이브러리 불러오기 -->
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=APIKEY&libraries=services,clusterer,drawing"></script>
</head>
<style>
    #user_img{
        width: 50px;
        height: 50px;
        border : 1px solid black;
        border-radius: 50%;
        background-color: blue;
    }
</style>
<body>
    <a href = '/'>Home</a>
    <p>회원정보 수정</p>


    <h1><%= user %>님 환영합니다.</h1>
    <div id = "map" style = "width: 500px; height : 400px;"></div>

    <div id = "result"></div>

    <form name = "form_profile">
        <div id = "profile_img">
            <label for = "prof_img_url">프로필 사진</label>
            <div id = "user_img" onclick = "imgEdit();"></div>
        </div>

        <input type="hidden" id="user_index" value="<%= data.user_index %>" />

        <label for = "user_id">ID</label>
        <input id = "user_id" name = "user_id" type = "text" value = "<%= data.user_id %>" required>
        <button type = "button">중복확인</button><br>

        <label for = "user_pw">PW</label>
        <input id = "user_pw" name = "user_pw" type = "password" value = "<%= data.user_pw %>" required><br>

        <label for = "user_name">NAME</label>
        <input id = "user_name" name = "user_name" type = "text" value = "<%= data.user_name %>" required><br>

        <label for = "user_email">email</label>
        <input id = "user_email" name = "user_email" type = "email" value = "<%= data.user_email %>" required>
        <button type = "button">중복확인</button><br>

        <!-- <label for = "user_adr">address</label>
        <input id = "user_adr" name = "user_adr" type = "text" required value = "<%= data.user_adr %>" required><br> -->

        <button type = "button" onclick = "profileEdit();">수정완료</button>
        <button type = "button" onclick = "profileDelete();">회원탈퇴</button>
        <a href = "/main2">main2</a>
        <a href = "/sign/logout">로그아웃</a>
    </form>

    <script>
        var container = document.getElementById('map');
		var options = {
			//center: new kakao.maps.LatLng(33.450701, 126.570667),
            center: new kakao.maps.LatLng(37.567130512492994, 126.97849370396516),
			level: 3
		};

		var map = new kakao.maps.Map(container, options);

        //clusterer: 마커를 클러스터링 할 수 있는 클러스터러 라이브러리
        //services: 장소검색과 주소-좌표 변환을 할 수 있는 services 라이브러리
        //drawing: 지도 위에 마커와 그래픽스 객체를 쉽게 그릴 수 있게 그리기 모드를 지원하는 drawing 라이브러리

        //지도를 클릭한 위치에 표출할 마커이다.
        var marker = new kakao.maps.Marker({
            //지도 중심좌표에 마커를 생성한다.
            position: map.getCenter()
        });

        //지도에 마커를 표시한다.
        marker.setMap(map);
        
        //지도에 클릭 이벤트를 등록한다.
        //지도를 클릭하면 마지막 파라미터로 넘어온 함수를 호출한다.
        kakao.maps.event.addListener(map, 'click', function(mouseEvent){
            //클릭한 위도, 경도 정보를 가져온다.
            var lating = mouseEvent.latLng;

            //마커 위치를 클릭한 위치로 옮긴다.
            marker.setPosition(lating);


            var message = '클릭한 위치의 경도는 ' + lating.getLat() + ' 이다<br>';
            message += '경도는 ' + lating.getLng() + ' 입니다.';

            var resultDiv = document.querySelector('#result');
            resultDiv.innerHTML = message;

            console.log('경도: ', lating.getLat());
            console.log('위도: ', lating.getLng());
        })

        

        let user_img = document.querySelector('#user_img');
        console.log('프로필 이미지 user_img >>', user_img);

    


        function imgEdit(){
            console.log('프로필 사진 선택');
        }


        function profileEdit(){
            const form = document.forms['form_profile'];
        
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            axios({
                method: 'POST',
                url: '/sign/profile/edit',
                data:{
                    user_index: form.user_index.value,
                    user_id: form.user_id.value,
                    user_pw: form.user_pw.value,
                    user_name: form.user_name.value,
                    user_email: form.user_email.value,
                    //user_adr: form.user_adr.value,
                },
            }).then((res) => {
                return res.data;
            }).then((data) => {
                alert(data);
            });
        }

        function profileDelete(){
            const form = document.forms['form_profile'];
            console.log('delete에서 form>> ', form);
            console.log('delete에서 form.id.value>> ', form.user_index.value);

            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            axios({
                method: 'POST',
                url: '/sign/profile/delete',
                data: {
                    user_index: form.user_index.value,
                }
            }).then((res) => {
                console.log('delete에서 axios res>> ', res);
                return res.data;
            }).then((data) => {
                alert('회원 탈퇴 성공');
                
                document.location.href = "/";
            })
        }
    </script>
</body>
</html>